function generateMobileNumber(){return new Date().getMilliseconds(),"+852"+(Math.floor(9e7*Math.random())+1e7).toString()}function AddUserFirebase(e){var a;return checkUserNumber(e,generateMobileNumber())}function addUser(e){var a=e.alp_chat_user_id;if(""==a)$.ajax({url:BASE_URL+"/get-user-info",type:"GET",async:!1,data:{uid:e.id},success:function(n){if(0!=n.data.length){var s=a=n.data.alp_chat_user_id,r=e.email,t=r,i=new Date().getTime();firebase.database().ref("data/users").orderByChild("e-mail").equalTo(e.email).once("value",n=>n.exists()?(s=(snapshotData=Object.keys(n.val()))[0],firebase.database().ref("data/users/"+s).update({name:e.name_en,nameToDisplay:e.name_en,username:e.name_en}),s):(firebase.database().ref("data/users/"+s).update({deviceToken:"",id:a,name:e.name_en,nameToDisplay:e.name_en,online:!1,osType:"web",profileName:a,selected:!0,status:"ALP-Chat",timeStamp:i,typing:"","e-mail":r,username:e.name_en,password:t}),a))}}});else{var n=a,s=e.email,r=s,t=new Date().getTime();firebase.database().ref("data/users").orderByChild("e-mail").equalTo(e.email).once("value",i=>i.exists()?(n=(snapshotData=Object.keys(i.val()))[0],firebase.database().ref("data/users/"+n).update({name:e.name_en,nameToDisplay:e.name_en,username:e.name_en}),n):(firebase.database().ref("data/users/"+n).update({deviceToken:"",id:a,name:e.name_en,nameToDisplay:e.name_en,online:!1,osType:"web",profileName:a,selected:!0,status:"ALP-Chat",timeStamp:t,typing:"","e-mail":s,username:e.name_en,password:r}),n))}return a}function checkUserNumber(e,a){var n=generateMobileNumber(),s=n,r=e.email,t=r,i=new Date().getTime();firebase.database().ref("data/users").orderByChild("id").equalTo(a).once("value",u=>{if(!u.exists())return firebase.database().ref("data/users/"+s).update({deviceToken:"",id:n,name:e.name_en,nameToDisplay:e.name_en,online:!1,osType:"web",profileName:n,selected:!0,status:"ALP-Chat",timeStamp:i,typing:"","e-mail":r,username:e.name_en,password:t}),n;checkUserNumber(e,a)})}function addGroup(e){var a=e.currentuser,n=e.new_group_title,s=e.searchIDData,r=e.new_group_description,t=new Date().getTime(),i="group_"+a+"_"+t;$("#dreamschat_group_id").val(i),firebase.database().ref("data/groups/"+i).set({admin:a,date:t,id:i,image:"",name:n,status:r,userIds:s})}function deleteGroupMember(e,a,n){var s="";setTimeout(function(){firebase.database().ref("data/users").orderByChild("e-mail").equalTo(e.email).once("value",e=>{if(e.exists()){s=(snapshotData=Object.keys(e.val()))[0];var a=firebase.database().ref("data/groups/"+n);a.once("value",function(e){if(e.val().userIds,void 0!=e.val().grpExitUserIds)var n=e.val().grpExitUserIds;else var n=[];n.push(s),a.update({grpExitUserIds:n})})}})},1e3)}function DeleteChatGroup(e){firebase.database().ref("data/groups/"+e).remove()}function AutoLoginAlpChat(e,a,n,s){return window.open(ALP_CHAT_BASE_URL+"login?username="+encodeURIComponent(e)+"&password="+encodeURIComponent(a)+"&language="+encodeURIComponent(n)+"&selectedGroup="+encodeURIComponent(s),"_blank"),!1}function checkGroupExists(e){firebase.database().ref("data/groups/"+e).once("value",function(e){return e.exists()?"1":"0"})}